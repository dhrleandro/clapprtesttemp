!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@clappr/core")):"function"==typeof define&&define.amd?define(["exports","@clappr/core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CptClapprPlugins={},t.Clappr)}(this,(function(t,e){"use strict";function n(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var o=t.apply(e,i);function s(t){n(o,r,a,s,c,"next",t)}function c(t){n(o,r,a,s,c,"throw",t)}s(void 0)}))}}function r(t,e,n){return e=c(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(e,n||[],c(t).constructor):e.apply(t,n))}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}function s(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(u=function(){return!!t})()}function h(){h=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var a=e&&e.prototype instanceof _?e:_,o=Object.create(a.prototype),s=new S(i||[]);return r(o,"_invoke",{value:I(t,n,s)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",f="suspendedYield",v="executing",m="completed",g={};function _(){}function b(){}function y(){}var k={};l(k,o,(function(){return this}));var T=Object.getPrototypeOf,C=T&&T(T(N([])));C&&C!==n&&i.call(C,o)&&(k=C);var E=y.prototype=_.prototype=Object.create(k);function w(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(r,a,o,s){var c=p(t[r],t,a);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(u).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var a;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return a=a?a.then(r,r):r()}})}function I(e,n,i){var r=d;return function(a,o){if(r===v)throw Error("Generator is already running");if(r===m){if("throw"===a)throw o;return{value:t,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var c=L(s,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===d)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=v;var l=p(e,n,i);if("normal"===l.type){if(r=i.done?m:f,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=m,i.method="throw",i.arg=l.arg)}}}function L(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var a=p(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=y,r(E,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:b,configurable:!0}),b.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},w(x.prototype),l(x.prototype,s,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new x(u(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},w(E),l(E,c,"Generator"),l(E,o,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=N,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}function d(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function f(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}var v=".thumbnails {\n  position: absolute;\n  bottom: 55px;\n  width: 100%;\n  opacity: 1;\n  transition: opacity 0.3s ease;\n}\n\n.thumbnails.hidden {\n  opacity: 0;\n}\n\n.thumbnails .thumbnail-container {\n  display: inline-block;\n  position: relative;\n  overflow: hidden;\n  background-color: #000000;\n}\n\n.thumbnails .thumbnail-container .thumbnail-img {\n  position: absolute;\n  width: auto;\n}\n\n.thumbnails .spotlight {\n  background-color: #000000;\n  overflow: hidden;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  border-color: #ffffff;\n  border-style: solid;\n  border-width: 2px;\n}\n\n.thumbnails .spotlight img {\n  width: auto;\n}\n\n.thumbnails .backdrop {\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  background-color: #000000;\n  overflow: hidden;\n}\n\n.thumbnails .backdrop .carousel {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  white-space: nowrap;\n}\n\n.thumbnails .backdrop .carousel img {\n  width: auto;\n}\n";f(v);var m=function(t){function n(t){var e;return a(this,n),(e=r(this,n,[t]))._thumbsLoaded=!1,e._show=!1,e._hoverPosition=0,e._oldContainer=null,e._thumbs=[],e._spotlightThumb=null,e._onThumbsLoaded=new Promise((function(t){e._onThumbsLoadedResolve=t})),e._buildThumbsFromOptions().then((function(){e._thumbsLoaded=!0,e._onThumbsLoadedResolve(),e._init()})).catch((function(t){throw t})),e}return l(n,t),s(n,[{key:"name",get:function(){return"thumbnails"}},{key:"supportedVersion",get:function(){return{min:"0.8.0"}}},{key:"attributes",get:function(){return{class:this.name}}},{key:"template",get:function(){return e.template('<% if (backdropHeight) { %>\n<div class="backdrop" style="height: <%= backdropHeight %>px;">\n\t<div class="carousel"></div>\n</div>\n<% }; %>\n<% if (spotlightHeight) { %>\n<div class="spotlight" style="height: <%= spotlightHeight %>px;"></div>\n<% }; %>\n')}},{key:"bindEvents",value:function(){e.Events.CORE_ACTIVE_CONTAINER_CHANGED&&this.listenTo(this.core,e.Events.CORE_ACTIVE_CONTAINER_CHANGED,this.rebindEvents),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_MOUSEMOVE_SEEKBAR,this._onMouseMove),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this._onMouseLeave),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_HIDE,this._onMouseLeave),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_RENDERED,this._init),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_CONTAINERCHANGED,this._onMediaControlContainerChanged)}},{key:"rebindEvents",value:function(){this.stopListening(),this.bindEvents()}},{key:"_bindContainerEvents",value:function(){this._oldContainer&&this.stopListening(this._oldContainer,e.Events.CONTAINER_TIMEUPDATE,this._renderPlugin),this._oldContainer=this.core.mediaControl.container,this.listenTo(this.core.mediaControl.container,e.Events.CONTAINER_TIMEUPDATE,this._renderPlugin)}},{key:"_onMediaControlContainerChanged",value:function(){this._bindContainerEvents()}},{key:"addThumbnail",value:function(t){var e=this,n=t.constructor===Array?t:[t];return this._onThumbsLoaded.then((function(){var t=n.map((function(t){return e._addThumbFromSrc(t).then((function(t){if(e._getOptions().backdropHeight){var n=e._thumbs.indexOf(t),i=e._buildImg(t,e._getOptions().backdropHeight);e._$backdropCarouselImgs.splice(n,0,i),1===e._$backdropCarouselImgs.length?e._$carousel.append(i):0===n?e._$backdropCarouselImgs[1].before(i):e._$backdropCarouselImgs[n-1].after(i)}}))}));return Promise.all(t).then((function(){t.length>0&&e._renderPlugin()}))}))}},{key:"removeThumbnail",value:function(t){var e=this,n=t.constructor===Array?t:[t];return this._onThumbsLoaded.then((function(){var t=!0,i=!1;return n.forEach((function(n){e._thumbs.some((function(t,i){return t.src===n&&(e._thumbs.splice(i,1),e._getOptions().backdropHeight&&(e._$backdropCarouselImgs[i].remove(),e._$backdropCarouselImgs.splice(i,1)),!0)}))?i=!0:t=!1})),i&&e._renderPlugin(),Promise.resolve(t)}))}},{key:"_init",value:function(){this._thumbsLoaded&&(this._$backdropCarouselImgs=[],this._createElements(),this._loadBackdrop(),this._renderPlugin())}},{key:"_getOptions",value:function(){if(!("Thumbnails"in this.core.options))throw"'Thumbnails property missing from options object.";return this.core.options.Thumbnails}},{key:"_appendElToMediaControl",value:function(){this.core.mediaControl.$el.find(".media-control-background").first().after(this.el)}},{key:"_onMouseMove",value:function(t){this._calculateHoverPosition(t),this._show=!0,this._renderPlugin()}},{key:"_onMouseLeave",value:function(){this._show=!1,this._renderPlugin()}},{key:"_calculateHoverPosition",value:function(t){var e=t.pageX-this.core.mediaControl.$seekBarContainer.offset().left;this._hoverPosition=Math.min(1,Math.max(e/this.core.mediaControl.$seekBarContainer.width(),0))}},{key:"_buildThumbsFromOptions",value:function(){var t=this,e=this._getOptions().thumbs.map((function(e){return t._addThumbFromSrc(e)}));return Promise.all(e)}},{key:"_addThumbFromSrc",value:function(t){var e=this;return new Promise((function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src=t.url})).then((function(n){var i=t.time,r=null;e._thumbs.some((function(t,e){return i<t.time&&(r=e,!0)})),null===r&&(r=e._thumbs.length);var a=r<e._thumbs.length?e._thumbs[r]:null,o=r>0?e._thumbs[r-1]:null;o&&(o.duration=i-o.time);var s=a?a.time-t.time:null,c=n.width,l=n.height,u={imageW:c,imageH:l,x:t.x||0,y:t.y||0,w:t.w||c,h:t.h||l,url:t.url,time:i,duration:s,src:t};return e._thumbs.splice(r,0,u),u}))}},{key:"_buildImg",value:function(t,n){var i=n/t.h,r=e.$("<img />").addClass("thumbnail-img").attr("src",t.url),a=e.$("<div />").addClass("thumbnail-container");return a.css("width",t.w*i),a.css("height",n),r.css({height:t.imageH*i,left:-1*t.x*i,top:-1*t.y*i}),a.append(r),a}},{key:"_loadBackdrop",value:function(){if(this._getOptions().backdropHeight)for(var t=this._$carousel,e=0;e<this._thumbs.length;e++){var n=this._buildImg(this._thumbs[e],this._getOptions().backdropHeight);this._$backdropCarouselImgs.push(n),t.append(n)}}},{key:"_updateCarousel",value:function(){if(this._getOptions().backdropHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=this.core.mediaControl.container.getStartTimeOffset(),i=n+e*t,r=this._$backdrop.width(),a=this._$carousel,o=a.width(),s=this._thumbs,c=o/s.length,l=this._getThumbIndexForTime(i),u=s[l],h=u.duration;null===h&&(h=Math.max(e+n-u.time,0));var p=l*c+c*((i-u.time)/h),d=p-t*r;a.css("left",-d);for(var f=this._getOptions().backdropMaxOpacity||.6,v=this._getOptions().backdropMinOpacity||.08,m=0;m<s.length;m++){var g=c*m-p;g<0&&(g=Math.min(0,g+c));var _=Math.max(f-Math.abs(g)/(2*c),v);this._$backdropCarouselImgs[m].css("opacity",_)}}}},{key:"_updateSpotlightThumb",value:function(){if(this._getOptions().spotlightHeight){var t=this._hoverPosition,e=this.core.mediaControl.container.getDuration(),n=this.core.mediaControl.container.getStartTimeOffset()+e*t,i=this._getThumbIndexForTime(n),r=this._thumbs[i],a=this._$spotlight;this._spotlightThumb!==r&&(a.empty(),a.append(this._buildImg(r,this._getOptions().spotlightHeight)),this._spotlightThumb=r);var o=this.$el.width(),s=a.width(),c=o*t-s/2;c=Math.max(Math.min(c,o-s),0),a.css("left",c)}}},{key:"_getThumbIndexForTime",value:function(t){for(var e=this._thumbs,n=e.length-1;n>=0;n--){if(e[n].time<=t)return n}return 0}},{key:"_renderPlugin",value:function(){this._thumbsLoaded&&(this._show&&this._thumbs.length>0?(this.$el.removeClass("hidden"),this._updateCarousel(),this._updateSpotlightThumb()):this.$el.addClass("hidden"))}},{key:"_createElements",value:function(){this.$el.html(this.template({backdropHeight:this._getOptions().backdropHeight,spotlightHeight:this._getOptions().spotlightHeight})),this.$el.append(e.Styler.getStyleFor(v)),this._$spotlight=this.$el.find(".spotlight"),this._$backdrop=this.$el.find(".backdrop"),this._$carousel=this._$backdrop.find(".carousel"),this.$el.addClass("hidden"),this._appendElToMediaControl()}}],[{key:"buildSpriteConfig",value:function(t,e,n,i,r,a,o){o=o||0;for(var s=[],c=0;c<e;c++)s.push({url:t,time:o+c*a,w:n,h:i,x:c%r*n,y:Math.floor(c/r)*i});return s}}])}(e.UICorePlugin),g=function(){return s((function t(e,n){a(this,t),this._cue=e,this.active=!1,this.id="cpttrackline"+n,this._cue.onenter=this._onEnter.bind(this),this._cue.onexit=this._onExit.bind(this)}),[{key:"_onEnter",value:function(t){this.active=!0}},{key:"_onExit",value:function(t){this.active=!1}},{key:"_formatSeconds",value:function(t){var e=Math.floor(t/60);e<10&&(e="0".concat(e));var n=Math.floor(t%60);return n<10&&(n="0".concat(n)),"".concat(e,":").concat(n)}},{key:"getText",value:function(){return this._cue.text}},{key:"getTime",value:function(){return this._formatSeconds(this._cue.startTime)+" - "+this._formatSeconds(this._cue.endTime)}},{key:"getStartTime",value:function(){return this._cue.startTime}}])}(),_=function(){return s((function t(e,n,i,r){a(this,t),this.id=e,this.name=n,this._onCueChangeCallback=r,this.lines=[];for(var o=0;o<i.cues.length;o++){var s=i.cues[o];this.lines.push(new g(s,o))}i.oncuechange=this.onCueChange.bind(this)}),[{key:"onCueChange",value:function(t){this._onCueChangeCallback(t,this)}},{key:"getActiveLines",value:function(){return this.lines.filter((function(t){return t.active}))}},{key:"getLineById",value:function(t){return this.lines.find((function(e){return e.id===t}))}}])}();function b(t){return y.apply(this,arguments)}function y(){return(y=i(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var k=function(){return s((function t(e){a(this,t),this._trackItems=[],this._activeItemId=0,this._onCueChangeCallback=e,this._tracks=new Map}),[{key:"setTracks",value:(t=i(h().mark((function t(e){var n,i,r,a;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._trackItems=e,this._trackItems.length>0&&!this._trackItems[this._activeItemId]&&(this._activeItemId=this._trackItems.length>0?this._trackItems[0].id:0),0===this._trackItems.length&&(this._activeItemId=0),n=0;case 4:if(!(n<this._trackItems.length)){t.next=19;break}if("showing"!==this._trackItems[n].track.mode){t.next=7;break}return t.abrupt("continue",16);case 7:this._trackItems[n].track.mode="hidden",i=performance.now();case 9:if(!(this._trackItems[n].track.cues.length<1)){t.next=16;break}if(!(performance.now()-i>5e3)){t.next=12;break}return t.abrupt("break",16);case 12:return t.next=14,b(100);case 14:t.next=9;break;case 16:n++,t.next=4;break;case 19:for(this._tracks=new Map,r=0;r<this._trackItems.length;r++)a=new _(this._trackItems[r].id,this._trackItems[r].name,this._trackItems[r].track,this._onCueChangeCallback.bind(this)),this._tracks.set(this._trackItems[r].id,a);case 21:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getTracks",value:function(){return this._tracks}},{key:"getNameTrackMap",value:function(){var t=new Map;return this._tracks.forEach((function(e){t.set(e.name,e)})),t}},{key:"getTracksIdNameList",value:function(){var t=this,e=[];return this._tracks.forEach((function(n){e.push({id:n.id,name:n.name,active:n.id===t._activeItemId})})),e}},{key:"getActiveTrack",value:function(){return this._tracks.get(this._activeItemId)}},{key:"setActiveTrack",value:function(t){var e=parseInt(t);return!!this._tracks.get(e)&&(this._activeItemId=e,!0)}},{key:"getActiveTrackId",value:function(){return this._activeItemId}}]);var t}(),T='/* Panel style */\n.cpt-transcription-panel[data-cpt-ts-panel] *,\n.cpt-transcription-panel[data-cpt-ts-panel] *::before,\n.cpt-transcription-panel[data-cpt-ts-panel] *::after {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] * {\n    font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";\n}\n.cpt-transcription-panel[data-cpt-ts-panel] {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    color: #000;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .input-selector {\n    display: none;\n}\n\n/* Header style */\n.cpt-transcription-panel[data-cpt-ts-panel] .panel-header {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    padding: 8px;\n    background-color: #f1f1f1;\n    border-bottom: 1px solid #a0a0a0;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .panel-header button {\n    opacity: 0.8;\n    color: #000;\n    background-color: transparent;\n    border: none;\n    padding: 0;\n    margin: 0;\n    cursor: pointer;\n    outline: none;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .panel-header button:hover {\n    opacity: 1;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .panel-header button svg {\n    width: 20px;\n    height: 20px;\n}\n\n/* Body style */\n.cpt-transcription-panel[data-cpt-ts-panel] .panel-body {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-start;\n    padding: 4px;\n    background-color: #fff;\n    padding-top: 4px;\n    overflow-x: hidden;\n    overflow-y: auto;\n}\n\n/* Trackline style */\n.cpt-transcription-panel[data-cpt-ts-panel] .trackline {\n    display: block;\n    width: 100%;\n    padding: 4px;\n    margin-bottom: 4px;\n    cursor: pointer;\n    border: 1px solid transparent;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .trackline[data-trackline-id].active {\n    background-color: #e6ffe6;\n    border: 1px solid #497f44;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .trackline .time {\n    width: 110px;\n    float: left;\n    font-size: 10pt;\n    line-height: 14pt;\n    cursor: pointer;\n    color:#2d2d2d;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .trackline .line {\n    cursor: pointer;\n    font-size: 16px;\n    color: #000;\n}\n\n/* Select style */\n.cpt-transcription-panel[data-cpt-ts-panel] {\n    --select-border: #777;\n    --select-focus: #00f;\n    --select-arrow: var(--select-border);\n}\n.cpt-transcription-panel[data-cpt-ts-panel] select {\n    appearance: none;\n    background-color: transparent;\n    border: none;\n    padding: 0 1em 0 0;\n    margin: 0;\n    width: 100%;\n    font-family: inherit;\n    font-size: inherit;\n    cursor: inherit;\n    line-height: inherit;\n    z-index: 1;\n    outline: none;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .select-container {\n    display: grid;\n    grid-template-areas: "select";\n    align-items: center;\n    position: relative;\n    font-size: 12pt !important;\n    min-width: 15ch;\n    max-width: 30ch;\n    border: 1px solid var(--select-border);\n    border-radius: 0.25em;\n    padding: 0.25em 0.5em;\n    font-size: 1.25rem;\n    cursor: pointer;\n    line-height: 1.1;\n    background-color: #fff;\n    background-image: linear-gradient(to top, #f9f9f9, #fff 33%);\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .select-container select,\n.cpt-transcription-panel[data-cpt-ts-panel] .select-container::after {\n    grid-area: select;\n}\n.cpt-transcription-panel[data-cpt-ts-panel] .select-container:not(.select-container--multiple)::after {\n    content: "";\n    justify-self: end;\n    width: 0.8em;\n    height: 0.5em;\n    background-color: var(--select-arrow);\n    clip-path: polygon(100% 0%, 0 0%, 50% 100%);\n}\n.cpt-transcription-panel[data-cpt-ts-panel] select:focus+.focus {\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    right: -1px;\n    bottom: -1px;\n    border: 2px solid var(--select-focus);\n    border-radius: inherit;\n}\n\n/* SCROLLBAR */\n.cpt-transcription-panel[data-cpt-ts-panel] ::-webkit-scrollbar {\n    width: 14px;\n    background: transparent;\n}\n\n.cpt-transcription-panel[data-cpt-ts-panel] ::-webkit-scrollbar-track { \n    border-radius: 0;\n}\n\n.cpt-transcription-panel[data-cpt-ts-panel] ::-webkit-scrollbar-thumb {\n    border-radius: 0;\n    background: #AEAEB7;\n} \n';f(T);var C=function(){return s((function t(e,n,i,r){a(this,t),this._container=e,this._manager=n,this._element=null,this._active=!1,this._activeTrackLinesIds=[],this._onCloseButtonClick=i,this._onTrackLineClickCallback=r}),[{key:"template",get:function(){return e.template('<div class="cpt-transcription-panel" data-cpt-ts-panel>\n    <div class="panel-header">\n        <div class="select-container">\n            <select name="cpt-ts-select-track" id="standard-select" data-cpt-ts-select-track>\n              <% for (var i = 0; i < avaiableTracks.length; i++) { %>\n                <option value="<%= avaiableTracks[i].id %>" <%= avaiableTracks[i].active ? \'selected\' : \'\' %>><%= avaiableTracks[i].name %></option>\n              <% }; %>\n            </select>\n        </div> \n        <button type="button" class="close-button" data-cpt-ts-close-button><%= closeIcon %></button>\n    </div>\n    <div class="panel-body">\n        <% for (var i = 0; i < lines.length; i++) { %>\n            <div class="trackline" data-trackline-id="<%= lines[i].id %>">\n                <div class="time">[<%= lines[i].getTime() %>]</div>\n                <div class="line"><%= lines[i].getText() %></div>\n            </div>\n        <% }; %>\n    </div>\n</div>')}},{key:"_removeElement",value:function(){this._container.querySelectorAll(".cpt-transcription-panel[data-cpt-ts-panel]").forEach((function(t){return t.remove()}))}},{key:"_createElement",value:function(){var t=this,n=this._manager.getTracksIdNameList(),i=this._manager.getActiveTrack(),r=this.template({closeIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><line x1="200" y1="56" x2="56" y2="200" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="200" y1="200" x2="56" y2="56" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>',avaiableTracks:n,lines:i?i.lines:[]}),a=e.Styler.getStyleFor(T),o=function(t){var e=document.createElement("template");e.innerHTML=t;var n=e.content.childNodes.length;if(1!==n)throw new Error("html parameter must represent a single node; got ".concat(n,". ")+'Note that leading or trailing spaces around an element in your HTML, like " <img/> ", get parsed as text nodes neighbouring the element; call .trim() on your input to avoid this.');return e.content.firstChild}(r);o.appendChild(a[0]);var s=o.querySelectorAll("select[data-cpt-ts-select-track]")[0];s&&s.addEventListener("change",this._onSelectedTrackChange.bind(this));var c=o.querySelectorAll("button[data-cpt-ts-close-button]")[0];c&&c.addEventListener("click",this._onCloseButtonClick);var l=o.querySelectorAll(".trackline[data-trackline-id]");l&&l.forEach((function(e){e.addEventListener("click",t._onTrackLineClick.bind(t))})),this._element=o,this._removeElement()}},{key:"_onSelectedTrackChange",value:function(t){var e=t.target;if(e&&e.options&&e.options[e.selectedIndex]){var n=e.options[e.selectedIndex].value;this._manager.setActiveTrack(n)||console.error("Track not found"),this._createElement();var i=this._manager.getActiveTrack(),r=i.getActiveLines().map((function(t){return t.id}));this.render(i.id,r)}}},{key:"_onTrackLineClick",value:function(t){var e=t.currentTarget;if(e){var n=e.getAttribute("data-trackline-id"),i=this._manager.getActiveTrack();if(i){var r=i.getLineById(n);r&&this._onTrackLineClickCallback&&this._onTrackLineClickCallback(r)}}}},{key:"_selectActiveTrackLine",value:function(t,e){if(e.length>0&&t===this._manager.getActiveTrack().id){var n=document.querySelectorAll(".cpt-transcription-panel .trackline[data-trackline-id].active");n&&n.forEach((function(t){return t.classList.remove("active")})),this._activeTrackLinesIds=e}var i=null;this._activeTrackLinesIds.forEach((function(t){var e=document.querySelector('.cpt-transcription-panel .trackline[data-trackline-id="'.concat(t,'"]'));e&&e.classList.add("active"),i=e})),i&&i.scrollIntoView({behavior:"auto",block:"center"})}},{key:"setManager",value:function(t){this._manager=t,this._createElement(),this.render()}},{key:"setActive",value:function(t){this._active=t,this._active?this.render():this._removeElement()}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._active&&(this._element||this._createElement(),document.querySelector(".cpt-transcription-panel[data-cpt-ts-panel]")||this._container.prepend(this._element),this._selectActiveTrackLine(t,e))}}])}(),E=".cpt-transcription {\n    float: right;\n    position: relative;\n    display: none;\n}\n\n.cpt-transcription.available {\n    display: block;\n}\n\n.cpt-transcription .cpt-ts-button {\n    display: block;\n    opacity: 1.0;\n}\n\n.cpt-transcription .cpt-ts-button:hover {\n    opacity: 1.0;\n    text-shadow: none;\n}";f(E);var w={Thumbnails:m,Transcription:function(t){function n(t){var e;a(this,n),e=r(this,n,[t]);var i=t.options.Transcription;return e._panelRenderContainer=i.PanelRenderContainer,e._onTrackChangeCallback=i.OnTrackChangeCallback,e._onActivatedTrackLineChangeCallback=i.OnActivatedTrackLineChangeCallback,e._onTranscriptionActivatedCallback=i.OnTranscriptionActivatedCallback,e._panelAvaiable=!1,e._ariaLabel="Transcrição",e._tracks=[],e._manager=new k(e._onCueChangeCallback.bind(e)),e._panelRender=new C(e._panelRenderContainer,e._manager,e.toggleTranscription.bind(e),e._onTrackLineClick.bind(e)),e._active=!1,e}return l(n,t),s(n,[{key:"name",get:function(){return"transcription"}},{key:"supportedVersion",get:function(){return{min:"0.8.0"}}},{key:"template",get:function(){return e.template('<button type="button" class="cpt-ts-button media-control-button media-control-icon" data-cpt-ts-button aria-label="<%= ariaLabel %>"></button>')}},{key:"events",get:function(){return{"click [data-cpt-ts-button]":"toggleTranscription"}}},{key:"attributes",get:function(){return{class:"cpt-transcription"}}},{key:"bindEvents",value:function(){this.listenTo(this.core,e.Events.CORE_ACTIVE_CONTAINER_CHANGED,this._containerChanged),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_RENDERED,this._renderTranscriptionPlugin),this.bindContainerEvents()}},{key:"bindContainerEvents",value:function(){this.container=this.core.activeContainer,this.container&&(this.listenTo(this.container,e.Events.CONTAINER_SUBTITLE_AVAILABLE,this._onSubtitleAvailable),this.listenTo(this.container,e.Events.CONTAINER_SUBTITLE_CHANGED,this._onSubtitleChanged),this.listenTo(this.container,e.Events.CONTAINER_STOP,this._onContainerStop))}},{key:"toggleTranscription",value:function(){this._active=!this._active,this._panelRender.setActive(this._active),this._onTranscriptionActivatedCallback&&this._onTranscriptionActivatedCallback(this._active)}},{key:"_onContainerStop",value:function(){this._transcriptionAvailable(!1)}},{key:"_containerChanged",value:function(){this._transcriptionAvailable(!1),this.stopListening(),this.bindEvents()}},{key:"_onSubtitleAvailable",value:function(){this._setTracks(),this._transcriptionAvailable(!0)}},{key:"_onSubtitleChanged",value:function(){this._setTracks()}},{key:"_transcriptionAvailable",value:function(t){var e=t?"addClass":"removeClass";this.$el[e]("available")}},{key:"_setTracks",value:function(){this._tracks=this.container?this.container.closedCaptionsTracks:[],this._tracks.length>0&&this._manager.setTracks(this._tracks),this._panelRender.setManager(this._manager),this._onTrackChangeCallback&&this._onTrackChangeCallback()}},{key:"_onCueChangeCallback",value:function(t,e){var n=e.getActiveLines().map((function(t){return t.id}));this._panelRender.render(e.id,n)}},{key:"_onTrackLineClick",value:function(t){this.container.playback.el.currentTime=t.getStartTime()+.1,this.container.playback.el.play()}},{key:"_renderButton",value:function(){var t=e.Styler.getStyleFor(E);this.$el.html(this.template({ariaLabel:this._ariaLabel})),this.$cptTsButton=this.$el.find("button.cpt-ts-button"),this.$cptTsButton.append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,176H96a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Zm0-32H96a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Zm-8-56V44l44,44Z"/></svg>'),this.$el.append(t[0])}},{key:"_renderTranscriptionPlugin",value:function(){this._setTracks(),this._renderButton();var t=this.core.mediaControl.$el.find("button[data-fullscreen]");return t[0]?this.$el.insertAfter(t):this.core.mediaControl.$el.find(".media-control-right-panel[data-media-control]").prepend(this.$el),this._panelRender.render(),this}}])}(e.UICorePlugin),SeekBarTouchFix:function(t){function n(t){var e;a(this,n),e=r(this,n,[t]);var i=t.options.SeekBarTouchFix;return e._playerWrapper=i.PlayerWrapper,e._init(),e._timeoutReference=null,e}return l(n,t),s(n,[{key:"name",get:function(){return"seek-bar-touch-fix"}},{key:"supportedVersion",get:function(){return{min:"0.8.0"}}},{key:"bindEvents",value:function(){e.Events.CORE_ACTIVE_CONTAINER_CHANGED&&this.listenTo(this.core,e.Events.CORE_ACTIVE_CONTAINER_CHANGED,this.rebindEvents),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this._mouseLeave),this.listenTo(this.core.mediaControl,e.Events.MEDIACONTROL_HIDE,this._mouseLeave)}},{key:"rebindEvents",value:function(){this.stopListening(),this.bindEvents()}},{key:"_touchHandler",value:function(t){var e=this,n=t.changedTouches[0],i={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touchcancel:"mouseout"}[t.type],r=new MouseEvent(i,{bubbles:!0,cancelable:!0,view:window,screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});n.target.dispatchEvent(r),this._timeoutReference&&window.clearTimeout(this._timeoutReference);var a=this.core.mediaControl.$seekBarContainer[0];a&&["touchend","touchcancel","mouseup","mouseout"].includes(i)&&(this._timeoutReference=window.setTimeout((function(){e._hideSeekTime();var t=new MouseEvent("mouseout",{bubbles:!0,cancelable:!0,view:window,screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});a.dispatchEvent(t)}),2e3))}},{key:"_init",value:function(){this._playerWrapper.addEventListener("touchstart",this._touchHandler.bind(this),!0),this._playerWrapper.addEventListener("touchmove",this._touchHandler.bind(this),!0),this._playerWrapper.addEventListener("touchend",this._touchHandler.bind(this),!0),this._playerWrapper.addEventListener("touchcancel",this._touchHandler.bind(this),!0)}},{key:"_mouseLeave",value:function(){this._hideSeekTime()}},{key:"_hideSeekTime",value:function(){var t=this.core.getPlugin("seek_time");t&&(t.hoveringOverSeekBar=!1);var e=document.querySelector(".seek-time[data-seek-time]");e&&"none"!==e.style.display&&(e.style.display="none")}}])}(e.UICorePlugin)};t.Plugins=w,t.version="0.1.0"}));
